# Trying Cython

Install via `pip install cython`

## Read the following:

On Cython website

* [basic tutorial](http://docs.cython.org/src/userguide/tutorial.html)
* [language basics](http://docs.cython.org/src/userguide/language_basics.html)
* [early binding](http://docs.cython.org/src/userguide/early_binding_for_speed.html#early-binding-for-speed)

On Stackoverflow:

* [Wrapping a C library in Python: C, Cython or ctypes?](http://stackoverflow.com/questions/1942298/wrapping-a-c-library-in-python-c-cython-or-ctypes)

From there I got the easy way to use Cython:

	$ cython mymodule.pyx
	$ gcc [some arguments here] mymodule.c -o mymodule.so

Which is somewhat easier than the whole setup approach. However for this to work you need Python development version:

	test.c:4:20: error: Python.h: No such file or directory
	test.c:6:6: error: #error Python headers needed to compile C extensions, please install development version of Python.


## Verdict

Cython creates some seriously bloated C code. The question is whether this is a problem

	$ wc -l hello.pyx
	1 hello.pyx
	$ wc -l hello.c
	1478 hello.c

Opening up that generated `hello.c` file makes my brain hurt. Here is a snippet:

	/* Generated by Cython 0.17.2 on Sat Nov 24 04:34:41 2012 */

	#define PY_SSIZE_T_CLEAN
	#include "Python.h"
	#ifndef Py_PYTHON_H
	    #error Python headers needed to compile C extensions, please install development version of Python.
	#elif PY_VERSION_HEX < 0x02040000
	    #error Cython requires Python 2.4+.
	#else
	#include <stddef.h> /* For offsetof */
	#ifndef offsetof
	#define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
	#endif
	#if !defined(WIN32) && !defined(MS_WINDOWS)
	  #ifndef __stdcall
	    #define __stdcall
	  #endif
	  #ifndef __cdecl
	    #define __cdecl
	  #endif
	  #ifndef __fastcall
	    #define __fastcall
	  #endif
	#endif
	#ifndef DL_IMPORT
	  #define DL_IMPORT(t) t
	#endif
	#ifndef DL_EXPORT
	  #define DL_EXPORT(t) t
	#endif
	#ifndef PY_LONG_LONG
	  #define PY_LONG_LONG LONG_LONG
	#endif
	#ifndef Py_HUGE_VAL
	  #define Py_HUGE_VAL HUGE_VAL
	#endif
	#ifdef PYPY_VERSION
	#define CYTHON_COMPILING_IN_PYPY 1
	#define CYTHON_COMPILING_IN_CPYTHON 0
	#else
	#define CYTHON_COMPILING_IN_PYPY 0
	#define CYTHON_COMPILING_IN_CPYTHON 1
	#endif
	#if PY_VERSION_HEX < 0x02050000
	  typedef int Py_ssize_t;
	  #define PY_SSIZE_T_MAX INT_MAX
	  #define PY_SSIZE_T_MIN INT_MIN
	  #define PY_FORMAT_SIZE_T ""
	  #define CYTHON_FORMAT_SSIZE_T ""
	  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
	  #define PyInt_AsSsize_t(o)   __Pyx_PyInt_AsInt(o)
	  #define PyNumber_Index(o)    ((PyNumber_Check(o) && !PyFloat_Check(o)) ? PyNumber_Int(o) : \
	                                (PyErr_Format(PyExc_TypeError, \
	                                              "expected index value, got %.200s", Py_TYPE(o)->tp_name), \
	                                 (PyObject*)0))
	  #define __Pyx_PyIndex_Check(o) (PyNumber_Check(o) && !PyFloat_Check(o) && \
	                                  !PyComplex_Check(o))
	  #define PyIndex_Check __Pyx_PyIndex_Check
	  #define PyErr_WarnEx(category, message, stacklevel) PyErr_Warn(category, message)
	  #define __PYX_BUILD_PY_SSIZE_T "i"
	#else
	  #define __PYX_BUILD_PY_SSIZE_T "n"
	  #define CYTHON_FORMAT_SSIZE_T "z"
	  #define __Pyx_PyIndex_Check PyIndex_Check
	#endif
	#if PY_VERSION_HEX < 0x02060000
	  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
	  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
	  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
	  #define PyVarObject_HEAD_INIT(type, size) \
	          PyObject_HEAD_INIT(type) size,
	  #define PyType_Modified(t)
	  typedef struct {
	     void *buf;
	     PyObject *obj;
	     Py_ssize_t len;
	     Py_ssize_t itemsize;
	     int readonly;
	     int ndim;
	     char *format;
	     Py_ssize_t *shape;
	     Py_ssize_t *strides;
	     Py_ssize_t *suboffsets;
	     void *internal;
	  } Py_buffer;
	  #define PyBUF_SIMPLE 0
	  #define PyBUF_WRITABLE 0x0001
	  #define PyBUF_FORMAT 0x0004
	  #define PyBUF_ND 0x0008
	  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
	  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
	  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
	  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
	  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)
	  #define PyBUF_RECORDS (PyBUF_STRIDES | PyBUF_FORMAT | PyBUF_WRITABLE)
	  #define PyBUF_FULL (PyBUF_INDIRECT | PyBUF_FORMAT | PyBUF_WRITABLE)
	  typedef int (*getbufferproc)(PyObject *, Py_buffer *, int);
	  typedef void (*releasebufferproc)(PyObject *, Py_buffer *);
	#endif
	#if PY_MAJOR_VERSION < 3
	...

painfull...
